---
title: "카프카"
order: 1
editable : false
tocDepth: 1
draft : true
---

## :worried: 카프카가 뭐에요?

프로듀서

컨슈머

높은처리량 : 데이터를 보낼 때 데이터를 받을 때 묶어서 전송하기 때문

데이터를 안전하게 보관하고 처리하기 위해 3대 이상의 브로커 서버를 1개의 클러스터로 묶어서 운영한다.

카프카 클러스터로 묶인 브로커들은 프로듀서가 보낸 데이터를 안전하게 분산 저장하고 복제한다.

카프카의 데이터 복제는 파티션 단위로 이루어진다. 토픽을 생성할 때 파티션의 복제 개수도 같이 설정한다.

옵션을 선택하지 않으면 브로커에 설정된 옵션값을 따라간다.  복제 개수의 최소값은 1 ( 복제 안함 ) 최댓값은 브로커 개수만큼 설정가능하다.

프로듀서 또는 컨슈머와 직접 통신하는 파티션을 리더, 복제 데이터를 가지고 있는 파티션을 팔로워라고 한다.

팔로워는 리더 파티션의 오프셋을 확인하여 자신과 차이가 있을 때 복제를 하게 된다.

리더 파티션이 죽게되면 팔로워 파티션 1개가 리더 파티션으로 승격된다.

토픽마다 복제 개수를 다르게 설정하여 운영할 수 있다.

컨트롤러 : 클러스터의 다수 브로커 중 한 대가 컨트롤러의 역할을 한다. 컨트롤러는 다른 브로커의 상태를 체크하고 브로커가 클러스터에서 빠지는 경우 해당브로커에 존재하는 리더 파티션을 재분배한다.

컨트롤러 역할을 하는 브로커도 장애가 생기면 다른 브로커가 컨트롤러 역할을 한다.

코디네이터 : 클러스터의 브로커 중 한 대는 코디네이터의 역할을 한다.

코디네이터는 컨슈머 그룹의 상태를 체크하고 파티션을 컨슈머와 매칭되도록 분배하는 역할을 한다. 컨슈머가 컨슈머 그룹에서 빠지면 매칭되지 않은 파티션을 정상 작동하는 컨슈머로 할당한다.

파티션을 컨슈머로 재할당하는 과정을 리밸런스라고 한다.


